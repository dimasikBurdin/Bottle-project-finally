(()=>{let e=L.map("mapid").setView([56.85,60.6],13);L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:18,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:"pk.eyJ1IjoiZGltYXNpa2J1cmRpbiIsImEiOiJja3VyNm5vNzEwb2N1Mm5xdnVmY2F2NmZkIn0.m48LWgVP-vrcXmP0r-oiBQ"}).addTo(e),L.icon({iconUrl:"./test-icon.png",iconSize:[50,50]});let t=new L.Control.OSMGeocoder;e.addControl(t);let n,i=document.querySelector(".search-form"),o=document.querySelector(".search-field"),l=(document.querySelector(".geo-submit"),document.querySelector(".geo-input"));i.addEventListener("submit",(i=>{i.preventDefault(),l.value=o.value,n&&e.removeLayer(n),t._geocode(i).then((t=>{if(0==t.length)return void console.log("ERROR: didn't find a result");let i=t[0].boundingbox,o=new L.LatLng(i[0],i[2]),l=new L.LatLng(i[1],i[3]),a=new L.LatLngBounds([o,l]);e.fitBounds(a);let s=t[0].lat,r=t[0].lon;n=L.marker(new L.LatLng(s,r)),n.addTo(e)}))})),e.addEventListener("click",(()=>{n&&e.removeLayer(n)}));let a=new HystModal({linkAttributeName:"data-hystmodal"}),s=document.querySelector(".modal-window"),r=document.querySelector(".modal-h"),d=(document.querySelector(".modal-categories"),document.querySelector(".modal-adress"),document.querySelector(".modal-description")),c=(document.querySelector(".modal-window-exit-button"),document.querySelector(".new-bottle")),m=document.querySelector(".profile"),u=document.querySelector(".chat");s.addEventListener("submit",(t=>{let n;t.preventDefault(),c.style.visibility="hidden",m.style.visibility="hidden",u.style.visibility="hidden",a.close();let i=!0,o=document.querySelector(".back-to-not-create");o.style.display="block",o.addEventListener("click",(()=>{i=!1,o.style.display="none",c.style.visibility="visible",m.style.visibility="visible",u.style.visibility="visible",r.value="",d.value="",n&&e.removeLayer(n)})),e.addEventListener("click",(t=>{if(!i)return;var l={format:"jsonv2",lat:t.latlng.lat,lon:t.latlng.lng};let a="https://nominatim.openstreetmap.org/reverse"+L.Util.getParamString(l);fetch(a).then((e=>e.json())).then((l=>{let a=l.name,s=`${l.address.city} ${l.address.road} ${l.address.house_number}`,v=function(e,t){let n=document.createElement("div");n.classList="quest-window";let i=document.createElement("p");i.classList="quest-text",i.textContent=`Хотите тут создать бутылочку? (${y(e,t)})`;let o=document.createElement("button");o.classList="quest-yes-button",o.textContent="Да";let l=document.createElement("button");return l.classList="quest-no-button",l.textContent="Нет",n.appendChild(i),n.appendChild(o),n.appendChild(l),n}(a,s);n=L.marker(t.latlng),n.addTo(e).bindPopup(v).openPopup(),i=!1;let h=document.querySelector(".quest-yes-button"),b=document.querySelector(".quest-no-button");h.addEventListener("click",(()=>{e.removeLayer(n);let l=L.icon({iconUrl:"./marker_siniy.svg",iconSize:[50,50]});new p(t.latlng,l,a,s),r.value="",d.value="",i=!1,c.style.visibility="visible",m.style.visibility="visible",u.style.visibility="visible",o.style.display="none"})),b.addEventListener("click",(()=>{e.removeLayer(n),i=!0}))}))}))}));class p{static id=0;constructor(t,n,i,o){this.id=p.id++,this.latlng=t,this.icon=n,this.name=i,this.adress=o,this.div=this._createDiv(i,o),this.markerBottle=L.marker(t,{icon:n}).addTo(e).bindPopup(this.div).openPopup()}_createDiv(e,t){let n=document.createElement("div");n.classList="marker-info";let i=document.createElement("h2");i.classList="marker-info-h2",n.appendChild(i);let o=document.createElement("p");o.classList="marker-info-street",n.appendChild(o);let l=document.createElement("textarea");l.classList="marker-info-field-des",l.setAttribute("readonly","readonly"),n.appendChild(l);let a=document.createElement("div");a.classList="marker-info-field-images",n.appendChild(a);let s=document.createElement("img");s.classList="marker-info-field-image",a.appendChild(s);let c=document.createElement("img");c.classList="marker-info-field-image",a.appendChild(c),n.appendChild(a);let m=document.createElement("button");return m.classList="marker-info-button",n.appendChild(m),i.textContent=r.value,o.textContent=y(e,t),l.textContent=d.value,s.src="test-icon2.jpg",c.src="test-icon2.jpg",m.textContent="К диалогу",n}removeMarker(){e.removeLayer(this.markerBottle),console.log(`bottle id=${this.id}, name=${this.name}, adress=${this.adress} has been removed`)}}function y(e,t){let n=t.split(" ").filter((e=>"undefined"!=e&&"null"!=e)).join(" ");return e&&t?`${e}, ${n}`:!e&&t?n:e&&!t?e:""}})();